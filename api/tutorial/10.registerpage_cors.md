# 页面绑定 api

1. 导入写好的 client，打开 register 页面，我们对 register 表单，添加提交操作

2. 登录逻辑， onSubmit{handleSubmit}

```js
const handleSumbit = (e) => {
  // 0. 防止自动默认刷新网页
  e.defaultPrevent();

  // 1. 使用FormData Api，提取表单数据
  const formData = new FormData(e.target);
  const username = formData.get("username");
  const email = formData.get("email");
  const password = formData.get("password");

  // 2. 使用 axios api，post 必要的数据到后端服务器。
  try {
    const res = await axios.post(".../auth/register", {username, email, password});
  } catch (err) {
    console.log(err);
  }
}
```

e.target 为选中的 form 元素，对 form 元素，添加到 FormData 对象中，会自动收集表单内所有字段，并且简化数据提交，会自动打包好进行发送。
FormData 对象提供了一系列方法（如 append, delete, get, set 等），允许开发者在创建后动态修改表单数据
axios 的 post 方法，包含两个参数，前面是发送的地址，后面是发送的数据
{
"username": username,
"email": email,
"password": password
}

**NOTE** 显示不到数据，因为服务端没有开启跨域
如何开启：

- npm i cors
- app.use(cors({
  origin: process.env.CLIENT_URL,
  credentials: true
  }));
  传入配置信息，

浏览器的同源策略（Same-Origin Policy）引起的。同源策略是一种安全措施，限制了一个源（origin）中的文档或脚本如何与另一个源的资源进行交互。它帮助防止恶意网站读取另一个网站上的敏感数据。
一个源由协议（如http, https）、域名（如example.com）、端口（如80, 443）三部分组成。只有当这三部分完全匹配时，两个URL才属于同一个源。
浏览器默认阻止从一个源向另一个源发起的AJAX请求，除非后端明确允许这种跨源请求。


3. 页面逻辑，设置成功跳转登录，设置错误信息展示在UI
  `const [error, setError] = useState("") `
  const navigeat = useNavigate();

  在post请求后面，添加，navigate("/login")
  在catch err后，添加，setError(err.response.data.message.data.message)
  并且，在注册表单下方，添加，`{error &&  <span> {error} </span>}`

4. login也是一样的逻辑，登录按钮，在等待post请求时，禁用按钮，请求完成，恢复可点击
``` js
const [isLoading, setIsLoading] = useState(false);
// 在请求之前，设置为true
// 在finally中，设置为false
<button disabled={isLoading}> Login </button>
```

5. 封装axios，参数信息，方便使用
在lib文件夹下，创建apiRequest.js 
创建并导出
``` js
const apiRequest = axios.create({
  baseURL: "http://localhost:8800/api",
  withCredentials: true,
});

// 在其他地方使用时：
apiRequest.post("/auth/login", data);
```

6. 登录成功，返回用户信息到浏览器，将信息保存到localStorage中
``` js
// 在登录逻辑中，请求到数据库数据之后，结构出userInfo，不将密码返回给，用户浏览器。
const [password, ...userInfo] = user;

// 设置返回信息，在res,json中。
{message="", userInfo }

// 在login route，请求成功后，保存
localStorage.setItem("user", JSON.stringify(res.data.userInfo));
```