# 使用 context hook，传递 localStorage 保存的 user 信息

1. 创建 AuthContext

```jsx
import { createContext, useEffect } from "react";
import { useState } from "react";

export const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [currentUser, setCurrentUser] = useState(
    JSON.parse(localStorage.getItem("user")) || null
  );

  const updateUser = (data) => {
    setCurrentUser(data);
  };

  useEffect(() => {
    localStorage.setItem("user", JSON.stringify(currentUser));
  }, [currentUser]);

  return (
    <AuthContext.Provider value={{ currentUser, updateUser }}>
      {children}
    </AuthContext.Provider>
  );
};
```

currentUser 就是本地的用户信息，updateUser，用于修改 currentUser 信息，当用户退出，设置 localStorage 的 user 字段为 null

使用 Context Hook，将 currentUser，以及 updateUser 传递到 Navbar 组件，Profile 页面，
将 UI 内容修改为，currentUser 中的信息。

navbar 的逻辑如下：

```jsx
const { currentUser } = useContext(AuthContext);
{
  currentUser ? (
    <div className="user">
      <img src={currentUser.avatar ? avatar : "/noavatar.jpg"} alt="" />
      <span>{currentUser.username}</span>
      <Link to="/profile" className="profile">
        <div className="notification">3</div>
        <span>Profile</span>
      </Link>
    </div>
  ) : (
    <>
      <a href="/login">Sign in</a>
      <a href="/register" className="register">
        Sign up
      </a>
    </>
  );
}
```

若当前 User 登录本地存有用户信息，则显示 User 的信息，不存在，则显示登录，注册按钮。

profile 中的退出逻辑如下：

```js
const {updateUser} = useContext(AuthContext);

const handleLogout = async () => {
  try {
    await apiRequest.post("/auth/logout");
    updateUser(null);
    navigate("/");
  } catch (err) {
    console.log(err);
  }
};
```
点击退出按钮，使用 context 的updateUser方法，设置currentUser为null，并跳转到网页主页，此时，主页nav，则显示登录注册信息。

