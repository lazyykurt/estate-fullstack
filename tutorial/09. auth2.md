关于注册

1. 获得请求信息 `const { username, email, password } = req.body;`
2. 密码加密 `const passwordHash = await bcrypt.hashSync(password, saltRounds);`
3. 选择对应的数据库 model，添加用户信息

```js
const newUser = await prisma.user.create({
  data: {
    username,
    email,
    password: passwordHash,
  },
});
```

4. 响应成功

```js
res.status(201).json({ message: "User created successfully" });
```

关于登录

1. 获得请求信息 `const { username, email, password } = req.body;`
2. 判断用户名是否存在，查询 findUnique()到不存在返回，401 错误，未找到用户

```js
const user = await prisma.user.findUnique({
  where: {
    username,
  },
});
if (!user) {
  return res.status(401).json({ message: "User not found" });
}
```

3. 判断密码是否正确，bcrypt 的 compare()，错误返回密码错误信息

````js
const isPasswordValid = await bcrypt.compare(password, user.password);
    if (!isPasswordValid) {
      return res.status(401).json({ message: "Invalid password" });
    }
    ```
````

4. 安装使用 cookie parser, `import cookieParser from "cookie-parser";`
5. 响应发送 cokie，设置在开发环境中 cookie，secure 为 false，httpOnly 设置为 true

```js
const age = 1000 * 60 * 60 * 24 * 28; // 4 weeks

const token = jwt.sign({ id: user.id }, process.env.JWT_SECRET, {
  expiresIn: age,
});

res
  .cookie("token", token, {
    httpOnly: true,
    // secure: process.env.NODE_ENV === "production",
    maxAge: age,
  })
  .status(200)
  .json({ message: "Login successfully" });
```

小知识：httpOnly 为 true： cookie 不能通过客户端脚本（比如 JavaScript）来访问...secure 为 true：防止 cookie 被窃听者拦截
maxAge，为 cookie 有效时间。 6. 设置 Jsonwebtoken，下载 npm i jsonwebtoken,

JWT：
一个参数，称为 payload。它是一个对象，包含了你想要包含在 JWT 中的数据。
第二个参数，是用于签名 token 的密钥。这个密钥应该是只有服务器知道的，用于验证 token 的真实性。
这是第三个参数，是一个选项对象。这里只设置了一个选项 expiresIn，它定义了 token 的有效期。

关于登出功能
使用res的clearCookie()方法，选择删除token，成功删除后返回200，成功退出。
```js
res.clearCookie("token").status(200).json({ message: "Logout successfully" });
```
